"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3138],{7271:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var t=n(4848),r=n(8453);const s={title:"Multimodal Data Linkage",id:"Multimodal Data Linkage",description:"An SOP for general conventions related to linking data between modalities"},a="Approved",o={id:"Multimodal-Linkage/Multimodal Data Linkage",title:"Multimodal Data Linkage",description:"An SOP for general conventions related to linking data between modalities",source:"@site/docs/Multimodal-Linkage/Multimodal-Linkage.mdx",sourceDirName:"Multimodal-Linkage",slug:"/Multimodal-Linkage/",permalink:"/Chorus_SOP/docs/Multimodal-Linkage/",draft:!1,unlisted:!1,editUrl:"https://github.com/chorus-ai/Chorus_SOP/edit/review/sop-website/docs/Multimodal-Linkage/Multimodal-Linkage.mdx",tags:[],version:"current",lastUpdatedBy:"Jared Houghtaling",lastUpdatedAt:1761679271,formattedLastUpdatedAt:"Oct 28, 2025",frontMatter:{title:"Multimodal Data Linkage",id:"Multimodal Data Linkage",description:"An SOP for general conventions related to linking data between modalities"},sidebar:"sopSidebar",previous:{title:"Multimodal Linkage",permalink:"/Chorus_SOP/docs/category/multimodal-linkage"},next:{title:"OMOP Mapping",permalink:"/Chorus_SOP/docs/category/omop-mapping"}},l={},d=[{value:"A: FILE ORGANIZATION",id:"a-file-organization",level:2},{value:"B: REGISTRY CONSTRUCTION",id:"b-registry-construction",level:2},{value:"C: OMOP INTEGRATION",id:"c-omop-integration",level:2},{value:"D: ANALYTICS INTEGRATION",id:"d-analytics-integration",level:2},{value:"SUPPLEMENTARY MATERIAL",id:"supplementary-material",level:2},{value:"MIMIC Approach",id:"mimic-approach",level:3}];function c(e){const i={a:"a",blockquote:"blockquote",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"approved",children:"Approved"}),"\n",(0,t.jsx)(i.h1,{id:"provisional-standard-operating-protocol-for-linking-multiple-modes-of-data",children:"[PROVISIONAL] Standard Operating Protocol for Linking Multiple Modes of Data"}),"\n",(0,t.jsx)(i.h1,{id:"purpose",children:"Purpose"}),"\n",(0,t.jsx)(i.p,{children:"Each image and waveform file in a CHoRUS data extract should be linked to a record in the EHR data for an associated patient and encounter using OMOP-specific identifiers."}),"\n",(0,t.jsx)(i.p,{children:"This SOP outlines a step-by-step approach for linking various modes of data together to ensure relational consistency and enable powerful cohort selection and analytical processes downstream."}),"\n",(0,t.jsx)(i.p,{children:"The sections below describe work that has already been done on the MIMIC synthetic dataset, and describe CHoRUS conventions for linkage as well as their underlying motivations."}),"\n",(0,t.jsx)(i.h1,{id:"scope",children:"Scope"}),"\n",(0,t.jsx)(i.p,{children:"This SOP is narrowly focused on linking imaging and waveform data acquired on the same patient to ensure data integrity."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"What this SOP does not do:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Manage bundles of related waveform or imaging files acquired in a single procedure."}),"\n",(0,t.jsx)(i.li,{children:"Include procedures for data deidentification, such as data shifting."}),"\n",(0,t.jsx)(i.li,{children:"Cover the submission of data to the cloud."}),"\n",(0,t.jsx)(i.li,{children:"Address data linking activities that occur in the cloud environment after sites have submitted the data."}),"\n"]}),"\n",(0,t.jsx)(i.h1,{id:"audience",children:"Audience"}),"\n",(0,t.jsx)(i.p,{children:"This SOP is intended for data acquisition site engineers that are assembling the required multi-modal dataset across a set of patients and are ready to preserve known linkages in a CHoRUS-standard format."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"Multimodal Linkage Workflow",src:n(7782).A+"",width:"2122",height:"1582"})}),"\n",(0,t.jsx)(i.h2,{id:"a-file-organization",children:"A: FILE ORGANIZATION"}),"\n",(0,t.jsx)(i.p,{children:"The ways in which data are organized has been defined by the Data Acquisition team and is defined in the Data-Upload-Update SOP. Further specification about the formatting of filenames will be covered in format-specific SOPs found in this documentation site."}),"\n",(0,t.jsx)(i.p,{children:"This organizational structure has been modified from the original Upload SOP, such that structured EHR data in OMOP CDM format are no longer included in the per-person file structure, as was recommended previously."}),"\n",(0,t.jsx)(i.p,{children:"The structure shown in Section A in the diagram above represents the most up-to-date version of the organization in which sites are expected to deliver data."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Note that the directory labeled 'root' in the 'Release' section can either be a dated release directory (if your site chooses to retain all files in each release in individual dirs) or it could be a naming convention of your choice."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"The [data upload/update SOP] will provide additional details on this directory structure and the creation of an associated upload manifest."}),"\n",(0,t.jsx)(i.h2,{id:"b-registry-construction",children:"B: REGISTRY CONSTRUCTION"}),"\n",(0,t.jsx)(i.p,{children:"The files listed in both the Images and Waveform subdirectories will need to be processed individually by sites for reasons that include re-organization, date shifting, removal of PHI (and verification of absence), etc."}),"\n",(0,t.jsxs)(i.p,{children:["During this processing, sites should construct two tabular ",(0,t.jsx)(i.em,{children:"REGISTRIES"})," that contain a ",(0,t.jsx)(i.strong,{children:"SINGLE ROW PER FILE"})," with data relevant to linking those files (1) together via session/accession, and (2) to data from other modalities."]}),"\n",(0,t.jsx)(i.p,{children:"These registries should contain the following columns:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"file_id"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Unique identifier pertaining to the file."}),"\n",(0,t.jsx)(i.li,{children:"Could be a hash, or any other identifier you would like."}),"\n",(0,t.jsx)(i.li,{children:"Should be unique (e.g. primary key) within registry table."}),"\n",(0,t.jsx)(i.li,{children:"Collisions across registry tables are discouraged but do not break the model"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"proc_id"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"In the example shown in the diagram above, image files are assigned procedure identifiers between 2000000000 and 2000999999, and waveform files are assigned procedure identifiers greater than 2001000000"}),"\n",(0,t.jsxs)(i.li,{children:["The cardinality may not match ",(0,t.jsx)(i.em,{children:"file_id"})," (e.g. multiple distinct ",(0,t.jsx)(i.em,{children:"file_id"})," values could be associated with a single ",(0,t.jsx)(i.em,{children:"proc_id"})," value)","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Information regarding organizational structures for waveform and imaging files, sessions, and studies will follow in those SOPs, respectively"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Must not overlap with other ",(0,t.jsx)(i.em,{children:"procedure_occurrence_id"})," values assigned to EHR-derived procedures"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": integer or bigint"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"person_id"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"person_id"})," value associated with the patient in your ",(0,t.jsx)(i.strong,{children:"OMOP"})," dataset. This id should also match the name of that files parent directory"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": integer or bigint"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"group_id"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Identifier that pertains to some grouping of files (e.g. session, accession, recording, etc.)"}),"\n",(0,t.jsx)(i.li,{children:"This column is flexible to accommodate different formats and in-house grouping strategies, but it should enable relevant connections between rows in your registries"}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": string"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"visit_id"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"visit_occurrence_id"})," value associated with the associated encounter recorded in your ",(0,t.jsx)(i.strong,{children:"OMOP"})," dataset."]}),"\n",(0,t.jsxs)(i.li,{children:["IF you don't have an explicit link between your file and an encounter identifier, you should infer the visit based on datetime (i.e. select the visit for the given patient that overlaps with the timestamp of the file capture)","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["IF there is no visit for that patient that overlaps with the file's timestamp (e.g. file was captured during an outpatient visit outside of OMOP) ",(0,t.jsx)(i.strong,{children:"LEAVE THIS FIELD NULL"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": integer or bigint"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"datetime"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Timestamp of the point at which the file was captured, within the ",(0,t.jsx)(i.strong,{children:"LOCAL"})," timezone"]}),"\n",(0,t.jsxs)(i.li,{children:["IF your site is shifting dates for EHR data prior to delivery, this field should represent the ",(0,t.jsx)(i.strong,{children:"SHIFTED"})," timestamp rather than the original timestmap"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": timestamp (local TZ)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"src_file"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Name and path of the source file in your data storage system, to enable traceback and quality control"}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": string"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"trg_file"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Name and path of the renamed file to be delivered with your extract, following the [naming convention] defined by the Data Acquisition team"}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"DATATYPE"}),": string"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["The registries that you produce should be delivered as CSV files, along with your extract, inside the ",(0,t.jsx)(i.strong,{children:"RELEASE"})," directory."]}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:["[!NOTE]\nWe will eventually add columns to these registries that contain information about the ways in which the files were captured.\nThis information will then be used to map files to ",(0,t.jsx)(i.strong,{children:"procedure_concept_id"})," values with additional granularity (e.g. ECG instead of Monitoring Procedure).\nProvisionally, all rows in the ",(0,t.jsx)(i.em,{children:"IMAGE REGISTRY"})," should be mapped to a ",(0,t.jsx)(i.strong,{children:"procedure_concept_id"})," of 4180938 (Imaging Procedure).\nAll rows in the ",(0,t.jsx)(i.em,{children:"WAVEFORM REGISTRY"})," should be mapped to a ",(0,t.jsx)(i.strong,{children:"procedure_concept_id"})," of 4141651 (Monitoring Procedure)"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"c-omop-integration",children:"C: OMOP INTEGRATION"}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:["[!WARNING]\nThe ",(0,t.jsx)(i.strong,{children:"procedure_occurrence_id"})," field serves a different purpose than the ",(0,t.jsx)(i.strong,{children:"procedure_concept_id"})," field.\n",(0,t.jsx)(i.strong,{children:"procedure_occurrence_id"})," is a unique identifier for a given row in the ",(0,t.jsx)(i.a,{href:"https://ohdsi.github.io/CommonDataModel/cdm54.html#procedure_occurrence",children:"PROCEDURE_OCCURRENCE table"}),", while\n",(0,t.jsx)(i.strong,{children:"procedure_concept_id"})," is a ",(0,t.jsx)(i.a,{href:"https://athena.ohdsi.org/search-terms/terms?standardConcept=Standard&page=1&pageSize=15&query=",children:"standard concept in the OMOP vocabulary"})," that denotes a particular medical procedure.\nThis distinction is critical in understanding how OMOP entities are created from the two file registries."]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["After creating the two registries, you should be able to use them directly to create rows in your OMOP PROCEDURE_OCCURRENCE table, ",(0,t.jsx)(i.a,{href:"https://github.com/chorus-ai/MIMIC/blob/fcb9b22ef13424f04a65e612eaf2ffe1d72485ea/etl/src/etl/mimic.py#L416",children:"as was done for the MIMIC dataset"})]}),"\n",(0,t.jsx)(i.p,{children:"Correspondence between the registry columns and PROCEDURE_OCCURRENCE columns are shown in color in SECTION C of the diagram above."}),"\n",(0,t.jsxs)(i.p,{children:["As was mentioned above in ",(0,t.jsx)(i.strong,{children:"B"}),", there are several important constraints to maintain during this integration:"]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"person_id"})," values should reference the appropriate patient in the PERSON table, and those values should also correspond with the person-level directory name in your extract organization"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"visit_occurrence_id"})," values should reference the appropriate encounter in the VISIT_OCCURRENCE table"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"procedure_occurrence_id"})," values should be distinct ",(0,t.jsx)(i.strong,{children:"PER PROCEDURE"})," and should not overlap with other procedure events in the PROCEDURE_OCCURRENCE table. It could be the case that multiple files/rows in the registry are associated with a single ",(0,t.jsx)(i.em,{children:"procedure_occurrence_id"})," value."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"procedure_concept_id"})," values should either be set to ",(0,t.jsx)(i.strong,{children:"4180938"})," (Imaging Procedure) for images, or ",(0,t.jsx)(i.strong,{children:"4141651"})," (Monitoring Procedure) for waveform files. ",(0,t.jsx)(i.strong,{children:"NOTE"})," that after this first implementation, we will suggest that sites map their imaging and waveforms with additional granularity. Any code needed to create the registries should be flexible to accommodate (sub)modality procedure mappings in the future."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"procedure_source_value"})," values should include a concatenated representation of (1) the target file path/name and (2) the group identifier associated with the particular file, should there be one."]}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["We suggest that you concatenate these items as key",":value",' pairs (e.g. "path: /some/file/path, group: [somegroupid])']}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["* Note that the ",(0,t.jsx)(i.strong,{children:"procedure_type_concept_id"})," field refers to the provenance of the data. The current vocabulary does not fully support this use case; in the interim, you can use ",(0,t.jsx)(i.a,{href:"https://athena.ohdsi.org/search-terms/terms/32880",children:"standard algorithm"}),", but we are investigating the minting of a new term in the ",(0,t.jsx)(i.strong,{children:"Type Concept"})," domain that accurately captures these linkage events."]}),"\n",(0,t.jsx)(i.h2,{id:"d-analytics-integration",children:"D: ANALYTICS INTEGRATION"}),"\n",(0,t.jsx)(i.p,{children:"The newly created rows in your OMOP CDM data allow for OMOP-specific cohort selection routines to isolate and capture non-tabular data forms."}),"\n",(0,t.jsx)(i.p,{children:"Eventually, we will implement a data structure using OMOP extension tables that enables both the data capture procedure, and features extracted from the resulting data, to be organized alongside other OMOP data."}),"\n",(0,t.jsx)(i.h2,{id:"supplementary-material",children:"SUPPLEMENTARY MATERIAL"}),"\n",(0,t.jsx)(i.h3,{id:"mimic-approach",children:"MIMIC Approach"}),"\n",(0,t.jsxs)(i.p,{children:["We have created and shared a ",(0,t.jsx)(i.a,{href:"https://github.com/chorus-ai/MIMIC/tree/main",children:"preliminary codebase for the MIMIC dataset"})," that includes the following:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://github.com/chorus-ai/MIMIC/blob/main/README.md",children:"Description"})," of registry creation and motivation"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://github.com/chorus-ai/MIMIC/blob/fcb9b22ef13424f04a65e612eaf2ffe1d72485ea/etl/src/etl/mimic.py#L233",children:"Function"})," to parse, transform, and rename imaging files"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://github.com/chorus-ai/MIMIC/blob/fcb9b22ef13424f04a65e612eaf2ffe1d72485ea/etl/src/etl/mimic.py#L285",children:"Function"})," to parse, transform, and rename waveform files"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://github.com/chorus-ai/MIMIC/blob/fcb9b22ef13424f04a65e612eaf2ffe1d72485ea/etl/src/etl/mimic.py#L390",children:"Function"})," to create dynamic insert SQL statements that insert rows into the PROCEDURE_OCCURRENCE table using the registry tables"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},7782:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/MMLinkage_Overview-33b551e6aaa15da04664435f6e2f4532.png"},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>o});var t=n(6540);const r={},s=t.createContext(r);function a(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);